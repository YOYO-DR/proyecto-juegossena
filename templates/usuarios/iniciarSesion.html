{% extends 'base.html' %} 
{% load static %} 
{% load widget_tweaks %} 
{% block contenido %}
<div class="inicio mt-2">
  <div>
    <h1>Iniciar sesión</h1>
    <p id="mensaje"></p>

    <form
    id="form"
      method="POST"
      class="border rounded p-3 col-lg-5 col-md-7 col-sm-9 col-xxl-4 d-flex flex-column"
      >
      {% csrf_token %} {% for field in form.visible_fields %}
      <div class="mb-3">
        {% comment %} {{field.id_for_label}} para acceder al id del input para
        ponerselo al label, ya esta por defecto en el input {% endcomment %}
        <label for="{{field.id_for_label}}" class="form-label"
          >{{field.label}}</label
        >
        {{field}}
      </div>
      {% endfor %}
      <div>
      <a href="{% url 'usuarios:olvidoContra' %}" class="link-primary w-auto">¿Olvidé mi contraseña?</a>
      </div>
      <button class="btn btn-success w-50" type="submit">Iniciar sesión</button>
    </form>
  </div>
</div>
{% endblock contenido %}
{% block js %}
<script src="{% static 'js/enviarpost.js' %}"></script>
<script>
document.addEventListener('DOMContentLoaded', function(){
  const form = document.getElementById('form')
  const mensaje=document.getElementById('mensaje')

  let callback=(data)=>{
    if ('error'in data){
      mensaje.className="mensaje-error"
      mensaje.innerHTML=data.error
    }else{
      mensaje.innerHTML=""
      window.location.href=data.urlRedirect
    }
  }
  enviarPost(
    "form", // id formulario
    "{{csrf_token}}",
    ".",
    callback
  )
})
</script>
{% endblock js %}